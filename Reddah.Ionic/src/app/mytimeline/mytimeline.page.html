
<ion-content [scrollEvents]="true" (ionScroll)="onScroll($event)">
    <div class="headerStart" #headerStart>
        <ion-item color="transparent" lines="none">
            <ion-icon name="arrow-round-back" slot="start" (click)="goback()"></ion-icon>
            <ion-label></ion-label>
            <ion-icon name="camera" slot="end" (click)="post($event)"></ion-icon>
        </ion-item>
    </div>
    <div class="headerOnScroll" #headerOnScroll>
        <ion-item color="light" lines="none">
            <ion-icon name="arrow-round-back" slot="start" (click)="goback()"></ion-icon>
            <ion-label>好友圈</ion-label>
            <ion-icon name="camera" slot="end" (click)="post($event)"></ion-icon>
        </ion-item>
    </div>
    <div>   
        <div class="timelineCover" #timelineCover>
            <img-loader src="assets/icon/timg.jpg"></img-loader>
        </div>
        <div class="timelineAvatar">
            <ion-label class="userNameTitle">{{userName}}</ion-label>
            <img-loader src="assets/icon/anonymous.png"></img-loader>
        </div>
        <div *ngFor="let article of articles" style="display: flex; border-bottom: 1px solid lightgrey; margin-bottom: 15px;padding-bottom: 10px;">
            <div style="width:70px;padding: 0px 10px; border: 0px solid blue;">
                <img-loader src="assets/icon/anonymous.png" class="border: 1px solid gray;" (click)="goUser(article.UserName)"></img-loader>
            </div>
            <div style="width:100%;border: 0px solid red;">
                <ion-card-header no-padding>
                    <ion-card-title>
                        <div [innerHTML]="htmlDecode(article.UserName)"></div>
                    </ion-card-title>
                </ion-card-header>
                <ion-item no-padding lines="none" *ngIf="article.Title.length<100">
                    <div [innerHTML]="htmlDecode(article.Title)"></div>
                </ion-item>
                <ion-item no-padding lines="none" *ngIf="article.Title.length>=100">
                    <div style="background-color: #eeeeee;padding: 5px;" [innerHTML]="summary(article.Title,50)"></div>
                </ion-item>
                <ion-card-content style="display:'none';" *ngIf="article.Content.split('$$$').length>0" no-padding>
                    <div class="parent" *ngIf="article.Content.split('$$$').length>6">
                        <div class="container" *ngFor="let image of article.Content.split('$$$')">
                            <img-loader src="{{image}}" class="picture" (click)="viewer(image)"></img-loader>
                        </div>
                    </div>
                    <div class="parent" *ngIf="article.Content.split('$$$').length>=3&&article.Content.split('$$$').length<=6">
                        <div class="container" *ngFor="let image of article.Content.split('$$$')">
                            <img-loader src="{{image}}" class="picture" (click)="viewer(image)"></img-loader>
                        </div>
                    </div>
                    <div *ngIf="article.Content.split('$$$').length<3">
                        <img-loader src="{{article.Content.split('$$$')[0]}}" class="singlePicture" (click)="viewer(article.Content.split('$$$')[0])"></img-loader>
                    </div>
                </ion-card-content>
                

                <ion-item no-padding lines="none">
                    <ion-note color="dark">{{article.CreatedOn | date: 'yyyy-MM-dd hh:mm:ss'}}</ion-note>
                    <ion-icon name="ios-more" slot="end" (click)="presentPopover($event, article.Id, article.GroupName)"></ion-icon>
                </ion-item>
                
                <div style="background-color: #eeeeee; width: 100%; padding: 10px 5px; margin-right: 15px;" *ngIf="article.GroupName">
                    <ion-icon name="heart-empty" style="display: inline-block;vertical-align: middle;"></ion-icon>
                    {{article.GroupName}}
                </div>
                <div *ngIf="article.GroupName&&commentData.get(article.Id)" style="border-bottom: 1px solid darkgray; width: 100%;margin-right: 15px;"></div>
                <div style="background-color: #eeeeee; width: 100%;margin-right: 15px;" *ngIf="commentData.get(article.Id)">
                    <div style="padding: 5px;" *ngIf="commentData.get(article.Id).Comments.length>0">
                        <ts-comment (reply)="showAddCommentFromChildren($event)" no-padding [data]="commentData.get(article.Id)" [depth]="1" [authoronly]="authoronly" 
                        [articleauthor]="article.UserName"></ts-comment>
                    </div>
                </div>
            </div>
        </div>
        
        <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)">
            <ion-infinite-scroll-content
                loadingSpinner="bubbles"
                loadingText="Loading more data...">
            </ion-infinite-scroll-content>
        </ion-infinite-scroll>
    </div>
</ion-content>
<ion-footer *ngIf="showAddComment">
    <ion-item margin-end>
        <ion-input #newComment id="newComment" placeholder="{{selectedReplyPlaceholder}}" padding-start></ion-input>
        <ion-icon name="happy" size="medium" margin-end (click)="toggleFacePanel()"></ion-icon>
        <ion-button (click)="SendComment(-1)" color="primary">发送</ion-button>
    </ion-item>
    
    <ion-grid *ngIf="showFacePanel">
        <ion-row *ngFor="let row of emojis">
            <ion-col *ngFor="let col of row" text-center>
                <span (click)="handleSelection(col)" style="width: 80px;height: 80px;">{{col}}</span>
            </ion-col>
        </ion-row> 
    </ion-grid>
</ion-footer>
