
<ion-content id="mycontent" [scrollEvents]="true" (ionScroll)="onScroll($event)" style="background-color:white;">
    <div class="headerStart" #headerStart>
        <ion-item color="transparent" no-padding lines="none"  (dblclick)="clearCacheAndReload()">
            <ion-icon name="ios-arrow-back" slot="start" (click)="goback()" class="backbutton"></ion-icon>
            <ion-label></ion-label>
        </ion-item>
    </div>
    <div class="headerOnScroll" #headerOnScroll>
        <ion-item color="light" no-padding lines="none">
            <ion-icon name="ios-arrow-back" slot="start" (click)="goback()" class="backbutton"></ion-icon>
            <ion-label>{{reddah.getDisplayName(userName)}}</ion-label>
        </ion-item>
    </div>
    <div>   
        <div class="timelineCover" #timelineCover>
            <img src="{{reddah.appData('cover_'+userName)}}">
        </div>
        <div class="timelineAvatar">
            <ion-label class="userNameTitle">{{userName}}</ion-label>
            <img src="{{reddah.appData('userphoto_'+userName)}}">
        </div>
        <div *ngFor="let article of articles;index as i">
            <p *ngIf="i==0||(i>0&&articles[i-1].CreatedOn.substring(0,4)!=article.CreatedOn.substring(0,4))" class="yearTitle">
                {{article.CreatedOn.substring(0,4)}}年
            </p>
            <div class="article">
                <div class="articleDate" *ngIf="reddah.getSendTimeShort(article.CreatedOn| date: 'yyyy-MM-dd HH:mm:ss')!=(article.CreatedOn| date: 'yyyy-MM-dd HH:mm:ss')">
                    <span *ngIf="i==0||(i>0&&articles[i-1].CreatedOn.split('T')[0]!=article.CreatedOn.split('T')[0])" class="dayTitle">
                        {{reddah.getSendTimeShort(article.CreatedOn| date: 'yyyy-MM-dd HH:mm:ss')}}
                    </span>
                </div>
                <div class="articleDate" *ngIf="reddah.getSendTimeShort(article.CreatedOn| date: 'yyyy-MM-dd HH:mm:ss')==(article.CreatedOn| date: 'yyyy-MM-dd HH:mm:ss')">
                    <span *ngIf="i==0||(i>0&&articles[i-1].CreatedOn.split('T')[0]!=article.CreatedOn.split('T')[0])" class="dayTitle">
                        {{article.CreatedOn|date:'dd'}}
                    </span>
                    <span *ngIf="i==0||(i>0&&articles[i-1].CreatedOn.split('T')[0]!=article.CreatedOn.split('T')[0])" class="monthTitle">
                        {{article.CreatedOn | date:'MM'}}月
                    </span>
                </div>
                <div class="articleContent">
                    <ion-item no-padding lines="none" *ngIf="(!article.Abstract||article.Abstract.length<3)&&article.Content.length>0" (click)="goTsViewer(article)">
                        <ion-thumbnail slot="start">
                            <img src="{{reddah.level2Cache(article.Content.split('$$$')[0])}}">
                        </ion-thumbnail>
                        <ion-label class="articleContentText" text-wrap>
                            <div [innerHTML]="reddah.summary(article.Title,20)" class="articleContentTextSummary"></div>
                            <div class="articleContentTextCount" *ngIf="article.Content.split('$$$').length>0">共{{article.Content.split('$$$').length}}张</div>
                        </ion-label>
                    </ion-item>
                    <ion-item no-padding lines="none" *ngIf="(!article.Abstract||article.Abstract.length<3)&&article.Content.length===0" (click)="goTsViewer(article)">
                        <div [innerHTML]="reddah.summary(article.Title,20)" class="textOnlyArticle"></div>
                    </ion-item>
                    <ion-item no-padding lines="none" *ngIf="article.Abstract&&article.Abstract.length>2&&article.Title&&article.Title.length>0" (click)="goTsViewer(article)">
                        <div [innerHTML]="reddah.summary(article.Title,20)" class="textOnlyArticle"></div>
                    </ion-item>
                    <app-share-article *ngIf="article.Abstract&&article.Abstract.length>2" [abstract]="article.Abstract" [image]="article.Content" [id]="article.Ref"></app-share-article>
                </div>
            </div>
        </div>
        
        <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)">
            <ion-infinite-scroll-content loadingSpinner="bubbles"
                loadingText="{{ 'Button.Loading' | translate }}">
            </ion-infinite-scroll-content>
        </ion-infinite-scroll>
    </div>
</ion-content>