<ion-item color="light" no-padding lines="none">
    <ion-icon name="ios-arrow-back" (click)="close()" class="backbutton"></ion-icon>
    <ion-text>评论详情</ion-text>
</ion-item>
<ion-content padding [scrollEvents]="true" (ionScroll)="commentbox.onScroll($event)">
    <ion-item lines="none" no-padding (click)="commentbox.addNewComment(comment.ArticleId, comment.Id)">
        <ion-avatar slot="start" class="avatar-top">
            <img src="{{reddah.appData('userphoto_'+comment.UserName)}}" class="portrait">
        </ion-avatar>
        <ion-label text-wrap style="font-size: 20px;">
            <div class="user-name">{{reddah.getDisplayName(comment.UserName)}}</div>
            <p style="font-size: 20px;">{{comment.CreatedOn | date:'MM-dd HH:mm'}}</p>
            <div [innerHTML]="reddah.htmlDecode(comment.Content) | safe: 'html'"></div>
        </ion-label>
    </ion-item>

    <ion-item lines="none" no-padding>
        <ion-label text-wrap style="font-size: 20px;">
            全部回复 {{allRepliesCount}}
        </ion-label>
        <!-- [interfaceOptions]="customPopoverOptions" interface="popover" -->
        <ion-select style="font-size: 20px;" value="latest" (ionChange)="sortComment(commentSortType.value)" 
        cancel-text="取消" ok-text="确定" #commentSortType>
            <ion-select-option value="latest">按最新</ion-select-option>
            <ion-select-option value="oldest">按最早</ion-select-option>
            <ion-select-option value="mostlike">按赞</ion-select-option>
        </ion-select>
    </ion-item>
    <div *ngFor="let reply of comments">
        <li *ngIf="childrenIds.includes(reply.Id)">
            <ion-item lines="none" no-padding (click)="commentbox.addNewComment(reply.ArticleId, reply.Id)">
                <ion-avatar slot="start" class="avatar-top" (click)="goUser(reply.UserName)">
                    <img src="{{reddah.appData('userphoto_'+reply.UserName)}}" class="portrait">
                </ion-avatar>
                <ion-label text-wrap>
                    <div style="display: flex;justify-content:space-between">
                        <span class="user-name" (click)="goUser(reply.UserName)">{{reddah.getDisplayName(reply.UserName)}}</span>
                        <div>
                            <span style="color: gray;margin-right:2px;margin-top:0;font-size: 20px;vertical-align: top;">{{reply.Count}}</span>
                            <ion-icon name="ios-thumbs-up" color="medium" style="margin-right:5px;width:25px;height:25px;"></ion-icon>
                            <ion-icon name="ios-more" style="width:25px;height:25px;"></ion-icon>
                        </div>
                    </div>
                    <p style="font-size: 20px;">{{reply.CreatedOn | date:'MM-dd HH:mm'}}</p>
                    <div *ngIf="reply.ParentId!=comment.Id" style="background-color:#eeeeee;padding:5px;font-size: 20px;">
                        <span class="user-name" (click)="goUser(GetUserNameByCommentId(comments,reply.ParentId))">{{reddah.getDisplayName(GetUserNameByCommentId(comments,reply.ParentId))}}</span> : <span style="font-size: 20px;" [innerHTML]="reddah.htmlDecode(GetContentByCommentId(comments,reply.ParentId)) | safe: 'html'"></span>
                    </div>
                    <div style="font-size: 20px;" [innerHTML]="reddah.htmlDecode(reply.Content) | safe: 'html'"></div>
                </ion-label>
            </ion-item>
        </li>
    </div>
</ion-content>
<app-comment-box #commentbox selectedArticleId="{{comment.ArticleId}}" selectedCommentId="{{comment.Id}}"
    (reloadComments)="childReloadComments($event)"></app-comment-box>