<ion-item color="light" no-padding lines="none">
    <ion-icon name="ios-arrow-back" (click)="close()" class="backbutton"></ion-icon>
    <ion-input placeholder="{{keywordPlaceholder}}" #searchKeyword clearInput (keyup.enter)="search()" (ionChange)="onSearchchange()"></ion-input>
</ion-item>
<ion-content no-padding style="background-color: white;" #searchResult>
    <ion-grid *ngIf="showTopic">
        <ion-row style="padding:10px;">
            <ion-col text-center>
                <ion-note>{{ 'Search.Filter' | translate }}</ion-note>
            </ion-col>
        </ion-row>
        <ion-row *ngFor="let row of topics" style="padding:10px;">
            <ion-col *ngFor="let col of row" text-center>
                <ion-text (click)="chooseTopic(col)">{{col.name}}</ion-text>
            </ion-col>
        </ion-row> 
    </ion-grid>
    <ion-grid *ngIf="selectedTopicId==1">
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_a"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_t" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="articles_a.length>0">{{ 'Menu.Recommend' | translate }}</span>
        </ion-row>
        <ion-row *ngFor="let article of articles_a" (click)="view(article)">
            <div>
                <span class="article-title articleTitle">{{reddah.htmlDecode(article.Title)}}</span>
                <ion-item>
                    <ion-avatar class="avatar-top" *ngIf="article.ImageUrls.length>0">
                        <img class="BrowsePreviewImageOne" src="{{article.ImageUrls[0]}}">
                    </ion-avatar>
                    <ion-label>
                        <p class="articleContent" text-wrap [innerHTML]="reddah.summary(article.Content, 100, article.Locale)"></p>
                        <ion-note class="user-name">{{reddah.getDisplayName(article.UserName)}}</ion-note>
                        <ion-note class="articleFooterTime">{{reddah.getSendTime(article.CreatedOnOrg| date: 'yyyy-MM-dd HH:mm:ss')}}</ion-note>
                    </ion-label>
                </ion-item>
            </div>
        </ion-row>
    </ion-grid>
    <ion-grid *ngIf="selectedTopicId==2">
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_t"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_t" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="articles_t.length>0">{{ 'Menu.Timeline' | translate }}</span>
        </ion-row>
        <ion-row *ngFor="let article of articles_t" (click)="goTsViewer(article)">
            <div style="width:100%;border-bottom: 1px solid #eeeeee;padding: 10px 0;">
                <span class="ts-article-title">{{reddah.summary(article.Title, 100, article.Locale)}}</span>
                <ion-item style="margin: 8px 0;" lines="none" *ngIf="article.Content.split('$$$').length>0&&article.Content.split('$$$')[0].length>0">
                    <ion-thumbnail *ngFor="let image of article.Content.split('$$$').splice(0,3);index as i" style="padding: 3px;">
                        <img src="{{image}}">
                    </ion-thumbnail>
                </ion-item>
                <ion-label class="articleTitle">
                    <ion-note class="user-name">{{reddah.getDisplayName(article.UserName)}}</ion-note>
                    <ion-note class="articleFooterTime">{{reddah.getSendTime(article.CreatedOnOrg| date: 'yyyy-MM-dd HH:mm:ss')}}</ion-note>
                </ion-label>
            </div>
        </ion-row>
    </ion-grid>
    <ion-grid *ngIf="selectedTopicId==3">
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_p"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_p" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="users_p&&users_p.length>0">{{ 'Menu.Publisher' | translate }}</span>
        </ion-row>
        <ion-row *ngIf="searchKeyword.value==null||searchKeyword.value.length==0&&users_p_recent.length>0">
            <ion-item lines="none">
                <ion-label>{{ 'Search.Recently' | translate }}</ion-label>
            </ion-item>
        </ion-row>
        <ion-row *ngIf="searchKeyword.value==null||searchKeyword.value.length==0">
            <ion-item lines="none">
                <div style="display: flex;flex-wrap: wrap;">
                    <div style="display: flex;flex-direction: column;margin-top:15px;" *ngFor="let pub_recent of users_p_recent">
                        <ion-avatar class="userPhoto" (click)="goPub(pub_recent)">
                            <img src="{{reddah.appDataPub('userphoto_'+pub_recent.UserName)}}" class="recentPortrait">
                        </ion-avatar>
                        <ion-label style="margin:0;padding:0 5px;width:75px;color:gray;" text-center>{{pub_recent.NickName}}</ion-label>
                    </div>
                </div>
            </ion-item>
        </ion-row>
        <ion-row *ngFor="let pub of users_p" (click)="goPub(pub)">
            <ion-item>
                <ion-avatar slot="start" class="contactUserPhoto">
                    <img src="{{reddah.appDataPub('userphoto_'+pub.UserName)}}" class="contactPortrait">
                </ion-avatar>
                <ion-label style="margin-left:10px;">
                    <span class="user-name" (press)="showChangeMenu($event, contact)">{{pub.NickName}}</span><br>
                    <ion-note color="dark">{{pub.Signature}}</ion-note>
                </ion-label>
            </ion-item>
        </ion-row>
    </ion-grid>
    <ion-grid *ngIf="selectedTopicId==4">
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_m"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_m" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="users_m&&users_m.length>0">{{ 'Menu.MiniApp' | translate }}</span>
        </ion-row>
        <ion-row *ngIf="searchKeyword.value==null||searchKeyword.value.length==0&&users_m_recent.length>0">
            <ion-item lines="none">
                <ion-label>{{ 'Search.Recently' | translate }}</ion-label>
            </ion-item>
        </ion-row>
        <ion-row *ngIf="searchKeyword.value==null||searchKeyword.value.length==0">
            <ion-item lines="none">
                <div style="display: flex;flex-wrap: wrap;">
                    <div style="display: flex;flex-direction: column;margin-top:15px;" *ngFor="let pub_recent of users_m_recent">
                        <ion-avatar class="userPhoto" (click)="goMini(pub_recent)">
                            <img src="{{reddah.appDataPub('userphoto_'+pub_recent.UserName)}}" class="recentPortrait">
                        </ion-avatar>
                        <ion-label style="margin:0;padding:0 5px;width:75px;color:gray;" text-center>{{pub_recent.NickName}}</ion-label>
                    </div>
                </div>
            </ion-item>
        </ion-row>
        <ion-row *ngFor="let pub of users_m" (click)="goMini(pub)">
            <ion-item>
                <ion-avatar slot="start" class="contactUserPhoto">
                    <img src="{{reddah.appDataPub('userphoto_'+pub.UserName)}}" class="contactPortrait">
                </ion-avatar>
                <ion-label style="margin-left:10px;">
                    <span class="user-name" (press)="showChangeMenu($event, contact)">{{pub.NickName}}</span><br>
                    <ion-note color="dark">{{pub.Signature}}</ion-note>
                </ion-label>
            </ion-item>
        </ion-row>
    </ion-grid>
    <ion-grid *ngIf="selectedTopicId==0">
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_a"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_a" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="articles_a.length>0">{{ 'Menu.Recommend' | translate }}</span>
        </ion-row>
        <ion-row *ngFor="let article_a of articles_a" (click)="view(article_a)">
            <div>
                <span class="article-title articleTitle">{{reddah.htmlDecode(article_a.Title)}}</span>
                <ion-item>
                    <ion-avatar class="avatar-top" *ngIf="article_a.ImageUrls.length>0">
                        <img src="{{article_a.ImageUrls[0]}}">
                    </ion-avatar>
                    <ion-label>
                        <p class="articleContent" text-wrap [innerHTML]="reddah.summary(article_a.Content, 100, article_a.Locale)"></p>
                        <ion-note class="user-name">{{reddah.getDisplayName(article_a.UserName)}}</ion-note>
                        <ion-note class="articleFooterTime">{{reddah.getSendTime(article_a.CreatedOnOrg| date: 'yyyy-MM-dd HH:mm:ss')}}</ion-note>
                    </ion-label>
                </ion-item>
            </div>
        </ion-row>
        <ion-row>
            <span class="articleTab" *ngIf="articles_a.length>0" (click)="more(0)">{{ 'Search.More' | translate }}>></span>
        </ion-row>
        <ion-row>
            <div style="display: flex; justify-content: center;"><ion-spinner name="bubbles" *ngIf="firstLoading_t"></ion-spinner></div>
            <ion-text *ngIf="firstLoading_t" class="loadingText">{{ 'Button.Loading' | translate }}</ion-text>
            <span class="articleTab" *ngIf="articles_t.length>0">{{ 'Menu.Timeline' | translate }}</span>
        </ion-row>
        <ion-row *ngFor="let article_t of articles_t" (click)="goTsViewer(article_t)">
            <div style="width:100%;border-bottom: 1px solid #eeeeee;padding: 10px 0;">
                <span class="ts-article-title">{{reddah.summary(article_t.Title, 100, article_t.Locale)}}</span>
                <ion-item style="margin: 8px 0;" lines="none" *ngIf="article_t.Content.split('$$$').length>0&&article_t.Content.split('$$$')[0].length>0">
                    <ion-thumbnail *ngFor="let image of article_t.Content.split('$$$').splice(0,3);index as i" style="padding: 3px;">
                        <img src="{{image}}">
                    </ion-thumbnail>
                </ion-item>
                <ion-label class="articleTitle">
                    <ion-note class="user-name">{{reddah.getDisplayName(article_t.UserName)}}</ion-note>
                    <ion-note class="articleFooterTime">{{reddah.getSendTime(article_t.CreatedOnOrg| date: 'yyyy-MM-dd HH:mm:ss')}}</ion-note>
                </ion-label>
            </div>
        </ion-row>
        <ion-row>
            <span class="articleTab" *ngIf="articles_t.length>0" (click)="more(1)">{{ 'Search.More' | translate }}>></span>
        </ion-row>
    </ion-grid>
    <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)" *ngIf="selectedTopicId!=0">
        <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="{{ 'Button.Loading' | translate }}">
        </ion-infinite-scroll-content>
    </ion-infinite-scroll>
</ion-content>
